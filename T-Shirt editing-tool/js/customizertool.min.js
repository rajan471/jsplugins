!function(){function e(e){var t={scale:1,left:at.width/2,top:at.width/2,angle:0,opacity:1,width:150,height:150},n={};for(key in t)n[key]=t[key];for(key in e)n[key]=e[key];var i=document.createElement("img");i.src=n.url,i.height=n.height,i.width=n.width;var a=new fabric.Image(i,{left:n.left,top:n.top,angle:n.angle,opacity:n.opacity});return a.hasRotatingPoint=!1,a}function t(e,t){""==e&&(e="Enter Text");var n={fontSize:20,fontFamily:"Roboto",fontWeight:"normal",textDecoration:"none   ",shadow:"none",fontStyle:"normal",stroke:"#000",strokeWidth:0,textAlign:"center",lineHeight:1,textBackgroundColor:"transparent",fill:"#000000"},i={};for(key in n)i[key]=n[key];for(key in t)i[key]=t[key];var a=new fabric.Textbox(e,i);a.left=.32*at.width+a.width/2,a.top=.26*at.width+a.height/2,a.originX="center",a.originY="center",a.editable=!1,a.width=180,a.hasRotatingPoint=!1,at.add(a),a.bringToFront(),at.renderAll()}function n(e){var t=e.target.src;fabric.loadSVGFromURL(t,function(e){var t=tt;t.centerH().setCoords();var n={width:t.width,height:t.height,scaleX:t.scaleX,scaleY:t.scaleY};t.width=150,t.height=150,t.scaleX=1,t.scaleY=1;var i=new fabric.PathGroup(e,{originX:"center",originY:"center",width:t.width,height:t.height});i.set({fill:"transparent"}),tt.set({clipTo:function(e){i.scaleToWidth(t.width),i.scaleToHeight(t.height),i.render(e)}}),t.width=n.width,t.height=n.height,t.scaleX=n.scaleX,t.scaleY=n.scaleY,V.renderAll()}),document.getElementById("clipMasks").style.display="none"}function i(){l(st[0].frontUrl)}function a(){r(st[0].backUrl)}function l(e){K.src=e}function r(e){teeBack.src=e}function c(t){document.getElementById("library").style.display="none",nt=t,at.remove(n),_={url:t,width:150,height:150,left:at.width/2,top:at.width/2};var n=e(_);n.originX="center",n.originY="center",at.add(n),at.renderAll()}function o(t){at.remove(tt),_={url:t,width:150,height:150,left:at.width/2,top:at.width/2};var n=e(_);n.originX="center",n.originY="center",at.add(n),at.renderAll()}function d(e){u(e)}function s(e){u(e)}function u(){tt=at.getActiveObject();var e=tt,t=e.top+at._offset.top,n=e.left+at._offset.left,i=e.type;if("textbox"==i){imageMenu.style.display="none",Q.style.display="block";var a=t-tt.height/2,l=n+tt.width/2+20;Q.style.top=a+"px",Q.style.left=l+"px",textMenuForm.fontSize.value=tt.fontSize,textMenuForm.fontFamily.value=tt.fontFamily,textMenuForm.changeText.value=tt.text,textMenuForm.fontColor.value=tt.fill,textMenuForm.opacity.value=tt.opacity}if("image"==i){Q.style.display="none",imageMenu.style.display="block",et.opacity.value=tt.opacity;var r=t-tt.height/2,c=n+tt.width/2+20;imageMenu.style.top=r+"px",imageMenu.style.left=c+"px"}}function m(){Q.style.display="none",imageMenu.style.display="none"}function p(){var e=document.getElementById("colors");e.innerHTML="";for(var t in st){var n=document.createElement("span");n.style.backgroundColor=st[t].color,n.className="swatch",n.setAttribute("data-url",st[t].frontUrl),n.setAttribute("data-backurl",st[t].backUrl),e.appendChild(n)}v()}function g(){var e=document.getElementById("library");e.innerHTML="",clipartURLS.forEach(function(t){var n=document.createElement("img"),i=document.createElement("div");i.className="artgraphic",i.appendChild(n),n.src=t,n.className="artgraphicImage",e.appendChild(i)}),f();var t=document.createElement("span");t.className="close",e.appendChild(t),t.addEventListener("click",function(){e.style.display="none"}),e.style.display="block"}function v(){for(var e=document.getElementsByClassName("swatch"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.getAttribute("data-url"),t=this.getAttribute("data-backurl");l(e),r(t),h(e,t)})}function f(){for(var e=document.getElementsByClassName("artgraphicImage"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.getAttribute("src");c(e)})}function h(e,t){var n=document.createElement("img");n.src=e;var i=document.createElement("img");i.src=t,tShirtsSides.children[0].innerHTML="",tShirtsSides.children[1].innerHTML="",tShirtsSides.children[0].appendChild(n),tShirtsSides.children[1].appendChild(i),tShirtsSides.children[0].addEventListener("click",function(){document.getElementById("croppingToolBack").style.display="none",document.getElementById("croppingToolFront").style.display="block",at=V,rt=K;var e=180/at.width;X(at,e),lt=180,at.renderAll()}),tShirtsSides.children[1].addEventListener("click",function(){document.getElementById("croppingToolBack").style.display="block",document.getElementById("croppingToolFront").style.display="none",at=q,rt=teeBack;var e=180/at.width;X(at,e),lt=180,at.renderAll()})}function y(e){e.preventDefault(),tt.fontSize=textMenuForm.fontSize.value,at.renderAll()}function E(e){e.preventDefault(),tt.fontFamily=textMenuForm.fontFamily.value,at.renderAll()}function k(e){e.preventDefault(),tt.fill=textMenuForm.fontColor.value,at.renderAll()}function x(e){e.preventDefault();var t="Enter Text";""!=textMenuForm.changeText.value.trim()&&(t=textMenuForm.changeText.value),tt.text=t;var n=tt.top,i=tt.left,a=document.getElementById("textMenu"),l=n-tt.height/2,r=i+tt.width/2+20;a.style.top=l+"px",a.style.left=r+"px",at.renderAll()}function b(e){e.preventDefault(),"active"==textMenuForm.bold.className?(tt.fontWeight="normal",textMenuForm.bold.className=""):(tt.fontWeight="bold",textMenuForm.bold.className="active"),at.renderAll()}function M(e){e.preventDefault(),"active"==textMenuForm.italic.className?(tt.fontStyle="normal",textMenuForm.italic.className=""):(tt.fontStyle="italic",textMenuForm.italic.className="active"),at.renderAll()}function F(e){e.preventDefault(),"active"==textMenuForm.underline.className?(tt.textDecoration="normal",textMenuForm.underline.className=""):(tt.textDecoration="underline",textMenuForm.underline.className="active"),at.renderAll()}function L(e){e.preventDefault(),textMenuForm.alignCenter.className="active",textMenuForm.alignJustify.className="",textMenuForm.alignLeft.className="",textMenuForm.alignRight.className="",tt.textAlign="center",at.renderAll()}function w(e){e.preventDefault(),textMenuForm.alignCenter.className="",textMenuForm.alignJustify.className="active",textMenuForm.alignLeft.className="",textMenuForm.alignRight.className="",tt.textAlign="justify",at.renderAll()}function B(e){e.preventDefault(),textMenuForm.alignCenter.className="",textMenuForm.alignJustify.className="",textMenuForm.alignLeft.className="active",textMenuForm.alignRight.className="",tt.textAlign="left",at.renderAll()}function A(e){e.preventDefault(),textMenuForm.alignCenter.className="",textMenuForm.alignJustify.className="",textMenuForm.alignLeft.className="",textMenuForm.alignRight.className="active",tt.textAlign="right",at.renderAll()}function I(e){e.preventDefault();var t=!1,n=$("<img src='"+nt+"' />");$("#imageCrop #image").html(n),$("#imageCrop").fadeIn();n.cropper({aspectRatio:1,zoomable:!1,crop:function(){t=!0}});$("#cropIt").unbind("click"),$("#cropIt").click(function(){if(t){var e=n.cropper("getCroppedCanvas");e=e.toDataURL("image/png"),o(e),$("#imageCrop").fadeOut()}})}function C(e){e.preventDefault(),at.remove(tt).renderAll()}function S(e){e.preventDefault(),at.sendBackwards(tt),V.sendToBack(Z),q.sendToBack(it)}function T(e){e.preventDefault(),at.bringForward(tt),V.sendToBack(Z),q.sendToBack(it)}function D(e){e.preventDefault();var t=fabric.util.object.clone(at.getActiveObject());V.deactivateAll(),q.deactivateAll(),at.setActiveObject(t),at.add(t),at.renderAll()}function N(e){e.preventDefault(),tt.angle+=90,at.renderAll()}function R(e){e.preventDefault(),tt.flipX=tt.flipX?!1:!0,at.renderAll()}function U(e){e.preventDefault(),tt.flipY=tt.flipY?!1:!0,at.renderAll()}function H(e){e.preventDefault();var t=document.getElementById("clipMasks");t.style.display="block",t.innerHTML="",maskClips.forEach(function(e){var i=document.createElement("div");i.className="mask",clipMaskImage=document.createElement("img"),clipMaskImage.src=e,i.appendChild(clipMaskImage),t.appendChild(i),i.addEventListener("click",n)})}function j(e){e.preventDefault(),tt.opacity=this.value,at.renderAll()}function X(e,t){e.setWidth(e.width*t),e.setHeight(e.height*t),rt.width=rt.width*t;var n=e.getObjects();n.forEach(function(e){if(e.left=e.left*t,e.top=e.top*t,"textbox"==e.type){e.scaleX*=t,e.scaleY*=t;{e.width*e.scaleX}}else e.width=e.width*t,e.height=e.height*t}),e.renderAll()}function Y(){var e=180/V.width;X(V,e),X(q,e),e=11,X(V,e);var t=document.getElementById("creative"),n=document.getElementById("creativeBack");("front"==ot||"both"==ot)&&t.toBlob(function(e){var t=new FormData;t.append("file",e,"front_image"),window.open(window.URL.createObjectURL(e))},"image/png"),e=1/e,X(V,e),e=11,X(q,e),("back"==ot||"both"==ot)&&n.toBlob(function(e){var t=new FormData;t.append("file",e,"front_image"),window.open(window.URL.createObjectURL(e))},"image/png"),e=1/e,X(q,e)}function O(){var e=pt.value;for(var t in StoreData)if(t==e){var n=StoreData[t].data,i=0;gt.innerHTML="";var a=document.createElement("option");a.value=-1,a.text="-----",gt.appendChild(a);for(var l in n){var a=document.createElement("option");a.value=i,a.text=n[l].name,gt.appendChild(a),i++}}}function P(e){e.preventDefault();var t=pt.value,n=gt.value;if(t>=0&&n>=0){var i=StoreData[t].data[n].products,a=document.getElementById("products");a.innerHTML="";for(var l in i)if(i[l].gender==vt.value){var r=document.createElement("div"),c=document.createElement("div");r.className="product-image";var o=document.createElement("img");o.src=i[l].productImage,o.setAttribute("data-prodid",l),r.appendChild(o),r.appendChild(c),c.innerHTML="<p>Type: "+i[l].type+"</p>";var d=i[l].availableColors,s=document.createElement("p");s.innerHTML="";for(var u in d){var m='<span class="swatch2" style="background-color:'+d[u].color+' " data-url="'+d[u].frontUrl+'" data-backurl="'+d[u].backUrl+'"></span>';s.innerHTML+=m}c.appendChild(s),a.appendChild(r),o.addEventListener("click",z)}}}function z(e){ct=e.target.getAttribute("data-prodid"),document.getElementById("printPositionOptions").style.display="block"}function W(){var e=pt.value,t=gt.value,n=StoreData[e].data[t].products[ct];st=n.availableColors,document.getElementById("croppingToolBack").style.display="none",document.getElementById("croppingToolFront").style.display="block",i(),a(),h(st[0].frontUrl,st[0].backUrl),p(),at=V,V.renderAll(),q.renderAll(),document.getElementById("changeProduct").style.display="none"}var J,G,_,Z,V,q,K,Q,et,tt,nt,it,at,lt,rt,ct,ot="both";K=document.getElementById("frontImage"),teeBack=document.getElementById("backImage"),G=document.createElement("img"),Q=document.getElementById("textMenu"),imageMenu=document.getElementById("imageMenu"),et=document.getElementById("imageMenuForm"),textMenuForm=document.getElementById("textMenuForm");var dt=document.getElementById("ChooseGraphicToCanvas");dt.addEventListener("click",g);var st=StoreData[0].data[0].products[0].availableColors;window.addEventListener("load",function(){p(),V=new fabric.Canvas("creative"),q=new fabric.Canvas("creativeBack"),i(),a(),h(st[0].frontUrl,st[0].backUrl),at=V,rt=K,V.setHeight(290),V.setWidth(180),q.setHeight(290),q.setWidth(180),V.renderAll(),q.renderAll(),lt=at.width;var e=document.getElementById("saveCanvas");e.addEventListener("click",function(){V.deactivateAll().renderAll(),q.deactivateAll().renderAll(),K.width=500,teeBack.width=500,scaleFactor=180/V.width,X(V,scaleFactor),scaleFactor=180/q.width,X(q,scaleFactor);var e=V.toDataURL(),t=q.toDataURL(),n=document.createElement("img"),i=document.createElement("img"),a=document.createElement("img"),l=document.createElement("img");n.src=e,a.src=t,document.getElementById("output").innerHTML="";var r=document.createElement("div");i.src=K.src,r.appendChild(i),r.appendChild(n),("front"==ot||"both"==ot)&&document.getElementById("output").appendChild(r);var c=document.createElement("div");l.src=teeBack.src,c.appendChild(l),c.appendChild(a),("back"==ot||"both"==ot)&&document.getElementById("output").appendChild(c),imageMenu.style.display="none",Q.style.display="none",Y()});var n=document.getElementById("uploadGraphicToCanvas");n.addEventListener("click",function(){var e=document.createElement("input");e.type="file",e.accept="image/x-png, image/jpeg",e.click(),e.addEventListener("change",function(e){if(files=e.target.files,FileReader&&files&&files.length){var t=new FileReader;t.onload=function(){var e=t.result;nt=t.result,at.remove(J),_={url:e,width:150,height:150,left:.32*at.width+75,top:.26*at.width+75},fabric.Image.fromURL(e,function(e){var t=e.set(_);t.originY="center",t.originX="center",at.add(t).renderAll;at.setActiveObject(t)})},t.readAsDataURL(files[0])}})}),document.addEventListener("keyup",function(e){e.explicitOriginalTarget!=textMenuForm.changeText&&46==e.keyCode&&(at.remove(tt).renderAll(),Q.style.display="none",imageMenu.style.display="none")});var l=document.getElementById("addText");l.addEventListener("click",function(){var e={fontSize:20,fontFamily:"comic sans ms"},n=document.getElementById("textToAdd").value;t(n,e)}),V.observe("object:moving",d),V.observe("object:scaling",s),V.on("object:selected",u),V.observe("selection:cleared",m),V.on("object:selected",function(){}),q.on("object:selected",u),q.observe("selection:cleared",m),q.on("object:selected",function(e){e.target.bringToFront()}),textMenuForm.fontSize.addEventListener("change",y),textMenuForm.fontFamily.addEventListener("change",E),textMenuForm.fontColor.addEventListener("change",k),textMenuForm.changeText.addEventListener("keyup",x),textMenuForm.bold.addEventListener("click",b),textMenuForm.italic.addEventListener("click",M),textMenuForm.underline.addEventListener("click",F),textMenuForm.alignCenter.addEventListener("click",L),textMenuForm.alignJustify.addEventListener("click",w),textMenuForm.alignLeft.addEventListener("click",B),textMenuForm.alignRight.addEventListener("click",A),textMenuForm.delete.addEventListener("click",C),textMenuForm.rotate.addEventListener("click",N),textMenuForm.duplicate.addEventListener("click",D),textMenuForm.flipX.addEventListener("click",R),textMenuForm.flipY.addEventListener("click",U),textMenuForm.sendBackward.addEventListener("click",S),textMenuForm.bringForward.addEventListener("click",T),textMenuForm.opacity.addEventListener("change",j),textMenuForm.opacity.addEventListener("input",j),et.crop.addEventListener("click",I),et.delete.addEventListener("click",C),et.rotate.addEventListener("click",N),et.duplicate.addEventListener("click",D),et.clipTo.addEventListener("click",H),et.flipX.addEventListener("click",R),et.flipY.addEventListener("click",U),et.sendBackward.addEventListener("click",S),et.bringForward.addEventListener("click",T),et.opacity.addEventListener("input",j),et.opacity.addEventListener("change",j),document.getElementById("canvasZoomIn").addEventListener("click",function(){lt+=50;var e=lt/at.width;X(at,e)}),document.getElementById("canvasZoomOut").addEventListener("click",function(){lt-=50;var e=lt/at.width;X(at,e)})});var ut=document.getElementById("changeProductBtn");ut.addEventListener("click",function(){document.getElementById("changeProduct").style.display="block",document.getElementById("printPositionOptions").style.display="none"});var mt=document.getElementById("changeprodcutForm"),pt=mt.category,gt=mt.subCategory,vt=mt.gender,ft=mt.submit;pt.addEventListener("change",O),O();var ht=document.getElementById("setprintPositionForm"),yt=ht.front,Et=ht.back,kt=ht.both;yt.addEventListener("click",function(e){e.preventDefault(),ot="front",tShirtsSides.children[0].style.display="inline-block",tShirtsSides.children[1].style.display="none",W(),tShirtsSides.children[0].click()}),Et.addEventListener("click",function(e){e.preventDefault(),ot="back",tShirtsSides.children[1].style.display="inline-block",tShirtsSides.children[0].style.display="none",W(),tShirtsSides.children[1].click()}),kt.addEventListener("click",function(e){e.preventDefault(),ot="both",tShirtsSides.children[0].style.display="inline-block",tShirtsSides.children[1].style.display="inline-block",W(),tShirtsSides.children[0].click()}),ft.addEventListener("click",function(e){e.preventDefault(),P(e)}),document.getElementById("frontImage").addEventListener("click",function(){document.getElementById("textMenu").style.display="none",document.getElementById("imageMenu").style.display="none",V.deactivateAll().renderAll(),q.deactivateAll().renderAll()}),document.getElementById("backImage").addEventListener("click",function(){document.getElementById("textMenu").style.display="none",document.getElementById("imageMenu").style.display="none",V.deactivateAll().renderAll(),q.deactivateAll().renderAll()})}();